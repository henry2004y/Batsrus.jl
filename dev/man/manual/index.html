<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · Batsrus.jl</title><meta name="title" content="Manual · Batsrus.jl"/><meta property="og:title" content="Manual · Batsrus.jl"/><meta property="twitter:title" content="Manual · Batsrus.jl"/><meta name="description" content="Documentation for Batsrus.jl."/><meta property="og:description" content="Documentation for Batsrus.jl."/><meta property="twitter:description" content="Documentation for Batsrus.jl."/><meta property="og:url" content="https://henry2004y.github.io/Batsrus.jl/man/manual/"/><meta property="twitter:url" content="https://henry2004y.github.io/Batsrus.jl/man/manual/"/><link rel="canonical" href="https://henry2004y.github.io/Batsrus.jl/man/manual/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../democards/nocoverlisttheme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li class="is-active"><a class="tocitem" href>Manual</a><ul class="internal"><li><a class="tocitem" href="#IDL-format-output-loader"><span>IDL format output loader</span></a></li><li><a class="tocitem" href="#Output-format-conversion"><span>Output format conversion</span></a></li><li><a class="tocitem" href="#HDF-format-output-loader"><span>HDF format output loader</span></a></li><li><a class="tocitem" href="#Data-visualization"><span>Data visualization</span></a></li></ul></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../internal/">Internal</a></li><li><a class="tocitem" href="../log/">Log</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Manual</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Manual</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/henry2004y/Batsrus.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/henry2004y/Batsrus.jl/blob/master/docs/src/man/manual.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="IDL-format-output-loader"><a class="docs-heading-anchor" href="#IDL-format-output-loader">IDL format output loader</a><a id="IDL-format-output-loader-1"></a><a class="docs-heading-anchor-permalink" href="#IDL-format-output-loader" title="Permalink"></a></h2><ul><li>Read data</li></ul><pre><code class="language-julia hljs">file = &quot;1d_bin.out&quot;;
bd = load(file);
bd = load(file, verbose=true);
bd = load(file, npict=1);</code></pre><ul><li>3D structured spherical coordinates</li></ul><pre><code class="language-julia hljs">file = &quot;3d_structured.out&quot;;
bd = load(file, verbose=false);</code></pre><ul><li>log file</li></ul><pre><code class="language-julia hljs">logfilename = &quot;shocktube.log&quot;;
head, data = readlogdata(logfilename)</code></pre><h3 id="Data-Extraction"><a class="docs-heading-anchor" href="#Data-Extraction">Data Extraction</a><a id="Data-Extraction-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Extraction" title="Permalink"></a></h3><ul><li>Checking variable range</li></ul><pre><code class="language-julia hljs">get_var_range(bd, &quot;rho&quot;)</code></pre><ul><li>Raw variables</li></ul><pre><code class="language-julia hljs">ρ = getvar(bd, &quot;rho&quot;)
bd[&quot;rho&quot;]</code></pre><ul><li>Derived variables</li></ul><pre><code class="language-julia hljs">v = getvars(bd, [&quot;Bx&quot;, &quot;By&quot;, &quot;Bz&quot;])
Bmag = bd[&quot;Bmag&quot;]</code></pre><ul><li>Extracting data at a given location</li></ul><pre><code class="language-julia hljs">loc = Float32[0.0, 0.0] # The type determines the output type
d = interp1d(bd, &quot;rho&quot;, loc)</code></pre><ul><li>Extracting data along a given line</li></ul><pre><code class="language-julia hljs">point1 = Float32[-10.0, -1.0]
point2 = Float32[10.0, 1.0]
w = interp1d(bd, &quot;rho&quot;, point1, point2)</code></pre><p>Here is a full list of predefined derived quantities:</p><table><tr><th style="text-align: right">Derived variable name</th><th style="text-align: right">Meaning</th><th style="text-align: right">Required variable</th></tr><tr><td style="text-align: right">B2</td><td style="text-align: right">magnetic field magnitude squared</td><td style="text-align: right">Bx, By, Bz</td></tr><tr><td style="text-align: right">E2</td><td style="text-align: right">electric field magnitude squared</td><td style="text-align: right">Ex, Ey, Ez</td></tr><tr><td style="text-align: right">U2</td><td style="text-align: right">velocity magnitude squared</td><td style="text-align: right">Ux, Uy, Uz</td></tr><tr><td style="text-align: right">Bmag</td><td style="text-align: right">magnetic field magnitude</td><td style="text-align: right">Bx, By, Bz</td></tr><tr><td style="text-align: right">Emag</td><td style="text-align: right">electric field magnitude</td><td style="text-align: right">Ex, Ey, Ez</td></tr><tr><td style="text-align: right">Umag</td><td style="text-align: right">velocity magnitude</td><td style="text-align: right">Ux, Uy, Uz</td></tr><tr><td style="text-align: right">B</td><td style="text-align: right">magnetic field vector</td><td style="text-align: right">Bx, By, Bz</td></tr><tr><td style="text-align: right">E</td><td style="text-align: right">electric field vector</td><td style="text-align: right">Ex, Ey, Ez</td></tr><tr><td style="text-align: right">U</td><td style="text-align: right">velocity vector</td><td style="text-align: right">Ux, Uy, Uz</td></tr></table><h2 id="Output-format-conversion"><a class="docs-heading-anchor" href="#Output-format-conversion">Output format conversion</a><a id="Output-format-conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Output-format-conversion" title="Permalink"></a></h2><p>We can convert 2D/3D BATSRUS outputs <code>*.dat</code> to VTK formats. It uses the VTK XML format writer <a href="https://github.com/jipolanco/WriteVTK.jl">writeVTK</a> to generate files for Paraview and Tecplot. The default converted filename is <code>out.vtu</code>.</p><ul><li>ASCII Tecplot file (supports both <code>tec</code> and <code>tcp</code>) and binary Tecplot file (set <code>DOSAVETECBINARY=TRUE</code> in BATSRUS <code>PARAM.in</code>):</li></ul><pre><code class="language-julia hljs">file = &quot;x=0_mhd_1_n00000050.dat&quot;
convertTECtoVTU(file)</code></pre><ul><li>3D structured IDL file (<code>gridType=1</code> returns rectilinear <code>vtr</code> file, <code>gridType=2</code> returns structured <code>vts</code> file):</li></ul><pre><code class="language-julia hljs">file = &quot;3d_structured.out&quot;
convertIDLtoVTK(file, gridType=1)</code></pre><ul><li>3D unstructured IDL file together with header and tree file:</li></ul><pre><code class="language-julia hljs">filetag = &quot;3d_var_1_n00002500&quot;
convertIDLtoVTK(filetag)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The file suffix should not be provided for this to work correctly!</p></div></div><ul><li>Multiple files:</li></ul><pre><code class="language-julia hljs">dir = &quot;./&quot;
filenames = filter(file -&gt; startswith(file, &quot;3d&quot;) &amp;&amp; endswith(file, &quot;.dat&quot;), readdir(dir))
filenames = dir .* filenames

for filename in filenames
   convertTECtoVTU(filename, filename[1:end-4])
end</code></pre><ul><li>Processing multiple files with threads in parallel:</li></ul><pre><code class="language-julia hljs">dir = &quot;./&quot;
filenames = filter(file -&gt; startswith(file, &quot;3d&quot;) &amp;&amp; endswith(file, &quot;.dat&quot;), readdir(dir))
filenames = dir .* filenames

Threads.@threads for filename in filenames
   println(&quot;filename=$filename&quot;)
   convertTECtoVTU(filename, filename[1:end-4])
end</code></pre><p>More examples can be found in <a href="https://github.com/henry2004y/Batsrus.jl/tree/master/examples">examples</a>.</p><h2 id="HDF-format-output-loader"><a class="docs-heading-anchor" href="#HDF-format-output-loader">HDF format output loader</a><a id="HDF-format-output-loader-1"></a><a class="docs-heading-anchor-permalink" href="#HDF-format-output-loader" title="Permalink"></a></h2><pre><code class="language-julia hljs">filename = &quot;3d__var_1_n00006288.h5&quot;
file = BatsrusHDF5Uniform(filename)</code></pre><h3 id="Field-extraction"><a class="docs-heading-anchor" href="#Field-extraction">Field extraction</a><a id="Field-extraction-1"></a><a class="docs-heading-anchor-permalink" href="#Field-extraction" title="Permalink"></a></h3><p>Variable <code>var</code> can be extracted in the whole domain:</p><pre><code class="language-julia hljs">var, (xl_new, yl_new, zl_new), (xu_new, yu_new, zu_new) = extract_var(file, &quot;bx&quot;)</code></pre><p>where <code>(xl_new, yl_new, zl_new)</code> and <code>(xu_new, yu_new, zu_new)</code> return the lower and upper bound, respectively.</p><p>Variables within a box region can be extracted as following:</p><pre><code class="language-julia hljs">var, (xl_new, yl_new, zl_new), (xu_new, yu_new, zu_new) =
   extract_var(file, &quot;bx&quot;; xmin, xmax, ymin, ymax, zmin, zmax)</code></pre><h2 id="Data-visualization"><a class="docs-heading-anchor" href="#Data-visualization">Data visualization</a><a id="Data-visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Data-visualization" title="Permalink"></a></h2><p>We provide plot recipes for Plots.jl, Makie.jl, and wrappers for PyPlot.jl.</p><p>The recipes for Plots.jl and Makie.jl will work on all kinds of plots given the correct dimensions, e.g.</p><pre><code class="language-julia hljs">using Plots

plot(bd, &quot;p&quot;)
contourf(bd, &quot;Mx&quot;, xlabel=&quot;x&quot;)</code></pre><p>See the official documentation for Plots.jl for more information.</p><p>On the other hand, most common 1D and 2D plotting functions are wrapped over their Matplotlib equivalences through PyPlot.jl. To trigger the wrapper, <code>using PyPlot</code>. Check out the documentation for more details.</p><h3 id="Quick-exploration-of-data"><a class="docs-heading-anchor" href="#Quick-exploration-of-data">Quick exploration of data</a><a id="Quick-exploration-of-data-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-exploration-of-data" title="Permalink"></a></h3><p>A general <code>plotdata</code> function is provided for quick visualizations using Matplotlib.</p><ul><li>1D binary</li></ul><pre><code class="language-julia hljs">plotdata(bd, &quot;p&quot;, plotmode=&quot;line&quot;)
plotdata(bd, &quot;p&quot;, plotmode=&quot;linegrid&quot;)</code></pre><ul><li>2D Cartesian (structured)</li></ul><pre><code class="language-julia hljs">plotdata(bd, &quot;p bx;by&quot;, plotmode=&quot;contbar streamover&quot;)
plotdata(bd, &quot;p bx;by&quot;, plotmode=&quot;contbar quiverover&quot;)
plotdata(bd, &quot;p bx;by&quot;, plotmode=&quot;contbar streamover&quot;, density=2.0)
plotdata(bd, &quot;p&quot;, plotmode=&quot;grid&quot;)
plotdata(bd, &quot;p&quot;, plotmode=&quot;contbar&quot;, plotrange=[-50., 50., -1., 1.])
plotdata(bd, &quot;p&quot;, plotmode=&quot;contbar&quot;)
plotdata(bd, &quot;p&quot;, plotmode=&quot;contbarlog&quot;)
plotdata(bd, &quot;p&quot;, plotmode=&quot;surfbar&quot;)</code></pre><ul><li>2D unstructured</li></ul><pre><code class="language-julia hljs">plotdata(bd, &quot;rho&quot;, plotmode=&quot;contbar&quot;)
plotdata(bd, &quot;rho&quot;, plotmode=&quot;trimesh&quot;)
plotdata(bd, &quot;rho&quot;, plotmode=&quot;tricont&quot;)</code></pre><ul><li>2D structured spherical coordinates</li></ul><pre><code class="language-julia hljs">plotdata(bd, &quot;rho&quot;, plotmode=&quot;contbar&quot;)</code></pre><ul><li>3D box</li></ul><pre><code class="language-julia hljs">plotdata(bd, &quot;bx&quot;, plotmode=&quot;contbar&quot;, dir=&quot;y&quot;, sequence=1, level=20)
plotdata(bd, &quot;bx&quot;, plotmode=&quot;contbar&quot;, dir=&quot;y&quot;, plotrange=[-1.4,-1.1,0.70,0.78])
plt.axis(&quot;scaled&quot;)

subplot(2,2,(1,3))
cutplot(bd, &quot;Ex&quot;; dir=&quot;y&quot;, sequence=128, plotrange)</code></pre><h4 id="Finding-indexes"><a class="docs-heading-anchor" href="#Finding-indexes">Finding indexes</a><a id="Finding-indexes-1"></a><a class="docs-heading-anchor-permalink" href="#Finding-indexes" title="Permalink"></a></h4><p>To get the index of a certain quantity, e.g. electron number density</p><pre><code class="language-julia hljs">ρe_= findfirst(x-&gt;x==&quot;rhoS0&quot;, bd.head.wnames)</code></pre><h3 id="Multiple-dispatch-for-Matplotlib-functions"><a class="docs-heading-anchor" href="#Multiple-dispatch-for-Matplotlib-functions">Multiple dispatch for Matplotlib functions</a><a id="Multiple-dispatch-for-Matplotlib-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-dispatch-for-Matplotlib-functions" title="Permalink"></a></h3><p>Using the same plotting functions as in Matplotlib is allowed, and actually recommended. Some plotting functions can be directly called as shown below, which allows for more control from the user. <code>using PyPlot</code> to import the full capability of the package, etc. adding colorbar, changing line colors, setting colorbar range with <code>clim</code>.</p><ul><li>line plot</li></ul><pre><code class="language-julia hljs">plot(bd, &quot;p&quot;, linewidth=2, color=&quot;green&quot;)
c = plot(bd, &quot;p&quot;)
plt.setp(c, linestyle=&quot;--&quot;, linewidth=2);</code></pre><ul><li>scatter plot</li></ul><pre><code class="language-julia hljs">scatter(bd, &quot;p&quot;)</code></pre><ul><li>contour</li></ul><pre><code class="language-julia hljs">contour(bd, &quot;p&quot;)</code></pre><ul><li>filled contour</li></ul><pre><code class="language-julia hljs">contourf(bd, &quot;p&quot;)
contourf(bd, &quot;p&quot;, levels, plotrange=[-10,10,-Inf,Inf], plotinterval=0.1)</code></pre><ul><li>surface plot</li></ul><pre><code class="language-julia hljs">plot_surface(bd, &quot;p&quot;)</code></pre><ul><li>triangle surface plot</li></ul><pre><code class="language-julia hljs">plot_trisurf(bd, &quot;p&quot;)</code></pre><ul><li>triangle filled contour plot</li></ul><pre><code class="language-julia hljs">tricontourf(bd, &quot;p&quot;)</code></pre><ul><li>streamline</li></ul><pre><code class="language-julia hljs">streamplot(bd, &quot;bx;bz&quot;)
streamplot(bd, &quot;bx;bz&quot;, density=2.0, color=&quot;k&quot;, plotinterval=1.0, plotrange=[-10,10,-Inf,Inf])</code></pre><ul><li>quiver (currently only for Cartesian grid)</li></ul><pre><code class="language-julia hljs">quiver(bd, &quot;ux;uy&quot;, stride=50)</code></pre><ul><li>streamline + contourf</li></ul><pre><code class="language-julia hljs">file = &quot;y.out&quot;
bd = load(file)

DN = matplotlib.colors.DivergingNorm
cmap = matplotlib.cm.RdBu_r

contourf(bd, &quot;uxS0&quot;, 50; plotrange=[-3,3,-3,3], plotinterval=0.05, norm=DN(0), cmap)
colorbar()
streamplot(bd, &quot;uxS0;uzS0&quot;; density=2.0, color=&quot;g&quot;, plotrange=[-3,3,-3,3])
xlabel(&quot;x&quot;); ylabel(&quot;y&quot;); title(&quot;Ux [km/s]&quot;)

contourf(bd, &quot;uxS0&quot;, 50; plotinterval=0.05, norm=DN(0), cmap)
colorbar()
axis(&quot;scaled&quot;)
xlabel(&quot;x&quot;); ylabel(&quot;y&quot;); title(&quot;uxS0&quot;)</code></pre><h3 id="Tracing"><a class="docs-heading-anchor" href="#Tracing">Tracing</a><a id="Tracing-1"></a><a class="docs-heading-anchor-permalink" href="#Tracing" title="Permalink"></a></h3><p>The built-in <code>streamplot</code> function in Matplotlib is not satisfactory for accurately tracing. Instead we recommend <a href="https://github.com/henry2004y/FieldTracer.jl">FieldTracer.jl</a> for tracing fieldlines and streamlines.</p><p>An example of tracing in a 2D cut and plot the field lines over contour:</p><pre><code class="language-julia hljs">file = &quot;test/y=0_var_1_t00000000_n00000000.out&quot;
bd = load(file)

bx = bd.w[:,:,5]
bz = bd.w[:,:,7]
x  = bd.x[:,1,1]
z  = bd.x[1,:,2]

seeds = select_seeds(x, z; nSeed=100) # randomly select the seeding points

for i in 1:size(seeds)[2]
   xs = seeds[1,i]
   zs = seeds[2,i]
   # Tracing in both direction. Check the document for more options.
   x1, z1 = trace2d_eul(bx, bz, xs, zs, x, z, ds=0.1, maxstep=1000, gridType=&quot;ndgrid&quot;)
   plot(x1, z1, &quot;--&quot;)
end
axis(&quot;equal&quot;)</code></pre><p>Currently the <code>select_seeds</code> function uses pseudo random number generator that produces the same seeds every time.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../../examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Friday 27 September 2024 02:40">Friday 27 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
